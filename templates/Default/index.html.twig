{% extends 'layout.html.twig' %}

{% block body %}
{{ include('nav.html.twig') }}
<link href="assets/vendor/bootstrap-fileinput/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
<!-- Header -->
<header>
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div>
                    <h2>Break to Words</h2>
<!--
                    <p>ทดสอบตัดคำภาษาไทย</p>
                    <h4>to</h4>
                    <p>ทดสอบ|ตัด|คำ|ภาษา|ไทย</p>
-->
                    <div class="row">
                        <div class="col-md-8 col-md-offset-2">
                            <!-- Nav tabs -->
                            <ul class="nav nav-pills" role="tablist">
                              <li role="presentation" class="active"><a href="#texttab" aria-controls="texttab" role="tab" data-toggle="tab">Text</a></li>
                              <li role="presentation"><a href="#filetab" aria-controls="filetab" role="tab" data-toggle="tab">Upload File</a></li>
                              <li role="presentation"><a href="#apitab" aria-controls="apitab" role="tab" data-toggle="tab">API</a></li>
                            </ul>
                            <!- Tab panes -->
                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="texttab">
                                    <p>
                                        <form name="breaktext">
                                            <textarea id="inputtext" class="form-control" rows="3" placeholder="พิมพ์ข้อความตัดคำภาษาไทย"></textarea>
                                            <br/>
                                            <div id="outputtext" class="well text-left"></div>
                                            <button type="button" id="parsebtn" class="btn btn-lg btn-outline"><i class="glyphicon glyphicon-scissors"></i> Parse</button>
                                            <button type="button" id="copybtn" data-clipboard-target="#outputtext" class="btn btn-lg btn-outline" data-placement="bottom" title="Copied to clipboard"><i class="glyphicon glyphicon-copy"></i> Copy</button>
                                        </form>
                                    </p>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="filetab">
                                    <p>
                                        <label class="control-label">Select File</label>
                                        <input id="uploadfileinput" type="file" class="file" data-show-preview="false" data-allowed-file-extensions='["csv", "txt"]' data-upload-url="/api/breaktowordsfile">
                                        <a href="/api/breaktowordsdownload"><button type="button" id="downloadbtn" class="btn btn-lg btn-outline"><i class="glyphicon glyphicon-floppy-save"></i> Download Result</button></a>
                                    </p>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="apitab">
                                    <h4 class="text-left">Example API call with curl</h4>
                                    <div class="well text-left">
                                        curl -H "Content-Type: application/json" "http://&lt;host>:&lt;port>/api/breaktowords/&lt;words>"
                                        <br/><br/>
                                        {"output":"&lt;break words>"}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- /Header -->
{% endblock %}

{% block script %}
{{ parent() }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>
<script src="assets/vendor/bootstrap-fileinput/js/fileinput.min.js"></script>
<script>
(function() {
    $("#copybtn").tooltip({
        trigger: 'click',
        placement: 'bottom',
        delay: 300
    });

    $("#downloadbtn").hide();

    var clipboardbtn = new Clipboard('#copybtn');
    clipboardbtn.on('success', function(e){
        e.clearSelection();
        // console.log(e.trigger);
        $("#copybtn").tooltip('show');
        setTimeout(function() {
            $("#copybtn").tooltip('hide');
        }, 1200);
    });
    $('button#parsebtn').click(function(){
        console.log("parse");
        $('#outputtext').text("");
        var inputtext = $('#inputtext').val();
        console.log('input:'+inputtext);
        if (inputtext.length > 0)
        {
            $.ajax({
                url: "/api/breaktowords/"+inputtext,
                contentType: "application/json; charset=UTF-8"
            })
            .done(function( data ) {
                console.log( "Parsed" );
                console.log(data);
                if ("error" in data)
                {
                    console.log("error");
                }
                else
                {
                    $('#outputtext').text(data.output);
                }
            });
        }
        else
        {
            console.log("No input");
        }

    });
    // $('#uploadfileinput').on('filepreupload', function(event, data, previewId, index) {
    //     console.log('File pre upload triggered');
    // });
    $('#uploadfileinput').on('fileuploaded', function(event, data, previewId, index) {
        console.log('File uploaded triggered');
        console.log(data);
        $("#downloadbtn").show();
        $(this).fileinput('enable').fileinput('refresh');
        console.log('refresh file uploaded');
    });
})();
</script>
{% endblock %}
